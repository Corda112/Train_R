# AQIæ»‘å‹•çª—å£è³‡æ–™ç”¢ç”Ÿç³»çµ± - å¿«é€Ÿæ“ä½œæŒ‡å—

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. ç³»çµ±åŸ·è¡Œ
```bash
# ç”Ÿç”¢ç’°å¢ƒåŸ·è¡Œ (å»ºè­°)
nohup Rscript generate_sliding_windows_production.R > output.log 2>&1 &

# ç›´æ¥åŸ·è¡Œ (æ¸¬è©¦ç”¨)
Rscript generate_sliding_windows_production.R
```

### 2. é€²åº¦ç›£æ§
```bash
# æª¢æŸ¥é€²åº¦
Get-ChildItem sliding_windows_production/progress/*.flag | Measure-Object

# æª¢æŸ¥è¼¸å‡º
Get-ChildItem sliding_windows_production/*/*.rds | Measure-Object
```

### 3. é©—è­‰çµæœ
```bash
# åŸ·è¡Œå®Œæ•´é©—è­‰
Rscript é©—è­‰å’Œä½¿ç”¨ç¯„ä¾‹.R
```

---

## ğŸ“Š ç³»çµ±ç‹€æ…‹ç¸½è¦½

**âœ… è™•ç†å®Œæˆç‹€æ…‹ (2025å¹´6æœˆ)**
- **å°æª”æ¡ˆ**: 150/150 æˆåŠŸ (100%)
  - Separate: 75å€‹æª”æ¡ˆ âœ…
  - Separate_Normalization: 75å€‹æª”æ¡ˆ âœ…
- **å¤§æª”æ¡ˆ**: 2/2 æˆåŠŸ (100%)
  - Combine: 17å€‹å€å¡Š + ç´¢å¼• âœ…
  - Combine_Normalization: 17å€‹å€å¡Š + ç´¢å¼• âœ…

**ğŸ“ˆ è³‡æ–™çµ±è¨ˆ**
- **ç¸½çª—å£æ•¸**: ~650è¬å€‹
- **ç¸½æª”æ¡ˆæ•¸**: 186å€‹
- **ç¸½å¤§å°**: 227.3 MB (å£“ç¸®å¾Œ)
- **è™•ç†æ™‚é–“**: ~4-6å°æ™‚ (å®Œæ•´è³‡æ–™é›†)

---

## ğŸ’¾ è³‡æ–™ä½¿ç”¨æ–¹æ³•

### è®€å–å°æª”æ¡ˆ (åˆ†ç«™è³‡æ–™)
```r
# è®€å–å–®ä¸€ç«™é»
w <- readRDS('sliding_windows_production/Separate/äºŒæ—_C0G730_combined_windows.rds')
X <- w$X_raw  # [43512, 72, 27] - çª—å£æ•¸ x æ™‚é–“æ­¥ x ç‰¹å¾µæ•¸
y <- w$y_raw  # [43512] - ç›®æ¨™AQIå€¼

# æ‰¹æ¬¡è®€å–æ‰€æœ‰ç«™é»
source('é©—è­‰å’Œä½¿ç”¨ç¯„ä¾‹.R')
data <- load_all_small_files("separate")
```

### è®€å–å¤§æª”æ¡ˆ (åˆä½µè³‡æ–™)
```r
# è®€å–ç´¢å¼•
idx <- readRDS('sliding_windows_production/Combine/Combine_AllData_index.rds')
cat("ç¸½çª—å£æ•¸:", format(idx$total_windows, big.mark=","))  # 3,268,728

# é€å€å¡Šè™•ç†
for(chunk_file in idx$chunk_files) {
  chunk_path <- file.path(idx$output_dir, chunk_file)
  w <- readRDS(chunk_path)
  
  # è™•ç†ç•¶å‰å€å¡Š (~20è¬çª—å£)
  X_chunk <- w$X_raw  # [n_windows, 72, 104]
  y_chunk <- w$y_raw  # [n_windows]
  
  # æ‚¨çš„æ¨¡å‹è¨“ç·´ä»£ç¢¼
  # model <- train_model(X_chunk, y_chunk)
}
```

---

## ğŸ”§ æ ¸å¿ƒåƒæ•¸èªªæ˜

### æ»‘å‹•çª—å£é…ç½®
```r
input_seq_len   <- 72    # è¼¸å…¥åºåˆ—: 72å°æ™‚ (3å¤©)
output_horizon  <- 1     # é æ¸¬ç¯„åœ: 1å°æ™‚
stride          <- 1     # æ»‘å‹•æ­¥é•·: 1ç­†
target          <- "AQI_aqi"  # é æ¸¬ç›®æ¨™
```

### è¨˜æ†¶é«”ç®¡ç†
```r
MAX_WINDOWS_PER_FILE <- 1000000  # å–®æª”æœ€å¤§çª—å£æ•¸ (64GB RAM)
chunk_size           <- 200000   # å¤§æª”åˆ†å¡Šå¤§å° (20è¬ç­†)
overlap              <- 72       # å€å¡Šé‡ç–Šç¢ºä¿é€£çºŒæ€§
```

---

## ğŸ“ è¼¸å‡ºçµæ§‹èªªæ˜

```
sliding_windows_production/
â”œâ”€â”€ Separate/                    # 75å€‹åˆ†ç«™åŸå§‹çª—å£æª”æ¡ˆ
â”‚   â”œâ”€â”€ äºŒæ—_C0G730_combined_windows.rds
â”‚   â”œâ”€â”€ ä¸‰ç¾©_C0G740_combined_windows.rds
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Separate_Normalization/      # 75å€‹åˆ†ç«™æ¨™æº–åŒ–çª—å£æª”æ¡ˆ
â”‚   â”œâ”€â”€ äºŒæ—_C0G730_combined_windows.rds
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Combine/                     # åˆä½µåŸå§‹è³‡æ–™ (17å€‹å€å¡Š)
â”‚   â”œâ”€â”€ Combine_AllData_chunk01.rds
â”‚   â”œâ”€â”€ Combine_AllData_chunk02.rds
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ Combine_AllData_index.rds
â”œâ”€â”€ Combine_Normalization/       # åˆä½µæ¨™æº–åŒ–è³‡æ–™ (17å€‹å€å¡Š)
â”‚   â”œâ”€â”€ Nomorlization_Combine_AllData_chunk01.rds
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ Nomorlization_Combine_AllData_index.rds
â””â”€â”€ progress/                    # é€²åº¦è¿½è¹¤æª”æ¡ˆ
    â”œâ”€â”€ äºŒæ—_C0G730_combined.flag
    â””â”€â”€ ...
```

---

## âš¡ æ•ˆèƒ½åŸºæº–

### è®€å–é€Ÿåº¦ (64GB RAMç’°å¢ƒ)
- **å°æª”æ¡ˆ**: ~100K çª—å£/ç§’
- **å¤§æª”æ¡ˆå€å¡Š**: ~19K çª—å£/ç§’
- **ç´¢å¼•æª”æ¡ˆ**: <0.001ç§’

### è¨˜æ†¶é«”ä½¿ç”¨
- **å°æª”æ¡ˆè™•ç†**: å³°å€¼ ~2GB
- **å¤§æª”æ¡ˆè™•ç†**: å³°å€¼ ~20-25GB
- **ä¸¦è¡Œè™•ç†**: é¡å¤– ~8GB

---

## ğŸ¯ æœ€ä½³å¯¦è¸

### 1. ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨
```bash
# èƒŒæ™¯åŸ·è¡Œä¸¦è¨˜éŒ„æ—¥èªŒ
nohup Rscript generate_sliding_windows_production.R > aqi_processing.log 2>&1 &

# ç›£æ§é€²åº¦
tail -f aqi_processing.log
```

### 2. æ¨¡å‹è¨“ç·´å»ºè­°
```r
# å°æª”æ¡ˆ: é©åˆç«™é»ç‰¹å®šæ¨¡å‹
for(station_file in station_files) {
  w <- readRDS(station_file)
  model <- train_station_model(w$X_raw, w$y_raw)
}

# å¤§æª”æ¡ˆ: é©åˆå…¨åŸŸæ¨¡å‹
idx <- readRDS('sliding_windows_production/Combine/Combine_AllData_index.rds')
for(chunk_file in idx$chunk_files) {
  w <- readRDS(file.path(idx$output_dir, chunk_file))
  model <- update_global_model(model, w$X_raw, w$y_raw)
}
```

### 3. è¨˜æ†¶é«”å„ªåŒ–
```r
# è™•ç†å®Œç«‹å³æ¸…ç†
w <- readRDS(chunk_path)
# ... è™•ç†è³‡æ–™ ...
rm(w); gc()  # é‡‹æ”¾è¨˜æ†¶é«”
```

---

## ğŸ“ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ
1. **è¨˜æ†¶é«”ä¸è¶³**: é™ä½ `MAX_WINDOWS_PER_FILE` æˆ– `chunk_size`
2. **æª”æ¡ˆè·¯å¾‘éŒ¯èª¤**: æª¢æŸ¥ `DATA_DIRS` è¨­å®šä¸­çš„å¤§å°å¯«
3. **Arrowå¥—ä»¶å•é¡Œ**: è¨­å®š `arrow_available <- FALSE` ä½¿ç”¨ç´”Rè™•ç†

### é©—è­‰å‘½ä»¤
```r
# æª¢æŸ¥ç³»çµ±å®Œæ•´æ€§
source('é©—è­‰å’Œä½¿ç”¨ç¯„ä¾‹.R')
verify_system_output()

# æª¢æŸ¥è³‡æ–™å“è³ª
check_data_quality()

# æ•ˆèƒ½æ¸¬è©¦
benchmark_performance()
```

---

**ç³»çµ±ç‰ˆæœ¬**: ç”Ÿç”¢ç´šæœ€çµ‚ç‰ˆ v1.0  
**ç›¸å®¹æ€§**: R 4.0+, Windows/Linux  
**å»ºè­°é…ç½®**: 64GB RAM, å¤šæ ¸å¿ƒCPU 