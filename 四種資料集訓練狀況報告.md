# 四種資料集訓練狀況報告

## 執行時間
**報告生成時間**: 2025-06-15 17:40

## 資料集狀況總覽

### 1. SEPARATE (分站原始資料)
- **檔案格式**: `*_windows.rds` ✅
- **檔案數量**: 75個檔案
- **訓練狀況**: ✅ **完全支援**
- **測試結果**: 
  - 成功訓練檔案: 1個 (限制測試)
  - LightGBM: RMSE 3.0657
  - LSTM: RMSE 3.2412

### 2. SEPARATE_NORM (分站標準化資料)  
- **檔案格式**: `*_windows.rds` ✅
- **檔案數量**: 75個檔案
- **訓練狀況**: ✅ **完全支援**
- **測試結果**:
  - 成功訓練檔案: 2個 (限制測試)
  - LightGBM: RMSE 0.0813, 0.2048
  - LSTM: RMSE 0.0888, 0.2104

### 3. COMBINE (合併原始資料)
- **檔案格式**: `*_chunk*.rds` + `*_index.rds` ❌
- **檔案數量**: 17個chunk檔案 + 1個index檔案
- **訓練狀況**: ❌ **無法訓練**
- **問題**: 完整管線只支援 `_windows.rds` 格式，不支援chunk格式
- **測試結果**: ⚠️ 跳過 - 沒有找到RDS檔案

### 4. COMBINE_NORM (合併標準化資料)
- **檔案格式**: `*_chunk*.rds` + `*_index.rds` ❌  
- **檔案數量**: 17個chunk檔案 + 1個index檔案
- **訓練狀況**: ❌ **無法訓練**
- **問題**: 完整管線只支援 `_windows.rds` 格式，不支援chunk格式
- **測試結果**: ⚠️ 跳過 - 沒有找到RDS檔案

## 問題分析

### 核心問題
完整訓練管線 (`run_full_pipeline`) 在第677行使用固定的檔案搜尋模式：
```r
files <- list.files(data_folders[[dtype]], pattern = "_windows\\.rds$", full.names = TRUE)
```

這個模式只能找到 `_windows.rds` 檔案，無法處理COMBINE資料的chunk格式。

### 系統設計衝突
1. **配置層面**: `config.R` 中COMBINE和COMBINE_NORM被標記為 `is_large = TRUE`
2. **單一訓練**: `train_single_model` 函數支援大檔案模式（僅使用第一個chunk）
3. **完整管線**: `run_full_pipeline` 函數不支援大檔案模式

## 當前訓練成果

### 成功訓練的模型數量
- **SEPARATE**: 2個模型 (LightGBM + LSTM) × 1個檔案 = 2個模型
- **SEPARATE_NORM**: 2個模型 (LightGBM + LSTM) × 2個檔案 = 4個模型  
- **COMBINE**: 0個模型
- **COMBINE_NORM**: 0個模型

**總計**: 6個模型 / 預期16個模型 (37.5%完成度)

### 性能表現
- **原始資料**: RMSE 3.0-3.3 (較高誤差)
- **標準化資料**: RMSE 0.08-0.21 (顯著改善)
- **GPU加速**: 完全正常，訓練時間1-2分鐘

## 解決方案建議

### 方案1: 修改完整管線支援大檔案模式 (推薦)
```r
# 在 run_full_pipeline 中添加大檔案處理邏輯
if(config$is_large) {
  # 使用 load_data_auto 載入第一個chunk
  data_loader <- load_data_auto(config$path, data_type = dtype, verbose = verbose)
  first_chunk <- data_loader()
  # 將chunk當作單一檔案處理
} else {
  # 現有的小檔案邏輯
}
```

### 方案2: 生成COMBINE的windows格式檔案
- 從chunk檔案重新生成 `*_windows.rds` 格式
- 需要修改滑動窗口生成系統

### 方案3: 創建專門的大檔案訓練管線
- 保持現有管線不變
- 新增 `run_large_file_pipeline` 函數

## 結論

**當前狀況**: 
- ✅ 小檔案模式 (SEPARATE/SEPARATE_NORM): 100%支援
- ❌ 大檔案模式 (COMBINE/COMBINE_NORM): 0%支援

**建議行動**:
1. 立即修改 `run_full_pipeline` 支援大檔案模式
2. 測試COMBINE和COMBINE_NORM的訓練功能
3. 完成四種資料集的完整訓練

**預期結果**: 修復後可達到100%完成度，總計16個訓練模型。 